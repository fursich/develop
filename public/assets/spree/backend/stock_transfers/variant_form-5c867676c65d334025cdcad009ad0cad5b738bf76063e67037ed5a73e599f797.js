(function(){var e;e=function(){function e(){}var t,r,n,i,a,s,o,u,l,c,f;return e.initializeForm=function(e){return t().variantAutocomplete({in_stock_only:e}),l()},e.beginListeningForReceive=function(){var e;return e=t(),e.on("select2-selecting",function(){return function(e){return e.preventDefault(),u(e.val)}}()),e.on("select2-loaded",function(){return function(e){if(1===e.items.results.length)return u(e.items.results[0].id)}}())},e.beginListeningForAdd=function(){var e;return e=t(),e.on("select2-selecting",function(){return function(e){return e.preventDefault(),n(e.val)}}()),e.on("select2-loaded",function(){return function(e){if(1===e.items.results.length)return n(e.items.results[0].id)}}())},t=function(){return null==this.variantAutocomplete&&(this.variantAutocomplete=$('[data-hook="transfer_item_selection"]').find(".variant_autocomplete")),this.variantAutocomplete},l=function(){return t().select2("val","").trigger("change").select2("open")},n=function(e){var t,n,a,s,o;return n=$("#stock_transfer_number").val(),$(".select2-results").html("<li class='select2-no-results'>"+Spree.translations.adding_match+"</li>"),o=$("[data-variant-id='"+e+"']"),o.length>0?(s=o.parents("tr:first").data("transfer-item-id"),t=parseInt($("#number-update-"+s).find(".js-number-update-text").text().trim(),10),a=new Spree.TransferItem({id:s,stockTransferNumber:n,expectedQuantity:t+1}),a.update(f,i)):(a=new Spree.TransferItem({stockTransferNumber:n,variantId:e,expectedQuantity:1}),a.create(r,i))},u=function(e){var t,r;return r=$("#stock_transfer_number").val(),$(".select2-results").html("<li class='select2-no-results'>"+Spree.translations.receiving_match+"</li>"),t=new Spree.StockTransfer({number:r}),t.receive(e,o,i)},r=function(e){return c(e,!1),show_flash("success",Spree.translations.created_successfully)},f=function(e){return c(e,!1),show_flash("success",Spree.translations.updated_successfully)},o=function(e){var t;return t={id:e.received_item.id,variant:e.received_item.variant,received_quantity:e.received_item.received_quantity},c(t,!0),Spree.StockTransfers.ReceivedCounter.updateTotal(),show_flash("success",Spree.translations.received_successfully)},c=function(e,t){var r,n,i,o;return l(),i=HandlebarsTemplates["stock_transfers/transfer_item"],o={id:e.id,isReceiving:t,variantId:e.variant.id,variantDisplayAttributes:a(e.variant),variantOptions:s(e.variant),variantImageURL:null!=(n=e.variant.images[0])?n.small_url:void 0},t?o.receivedQuantity=e.received_quantity:o.expectedQuantity=e.expected_quantity,r=i(o),$("tr[data-transfer-item-id='"+e.id+"']").remove(),$("#listing_transfer_items tbody tr:first").length>0?$("#listing_transfer_items tbody tr:first").before(r):$("#listing_transfer_items tbody").html(r),$("#listing_transfer_items").prop("hidden",!1),$(".no-objects-found").prop("hidden",!0),$("tr[data-transfer-item-id='"+e.id+"']").fadeIn()},i=function(e){var t,r;return l(),t=null!=(null!=(r=e.responseJSON)?r.error:void 0)&&null==e.responseJSON.errors?e.responseJSON.error:e.responseText,show_flash("error",t)},a=function(e){var t;return t=JSON.parse($("#variant_display_attributes").val()),_.map(t,function(){return function(t){return{label:Spree.translations[t.translation_key],value:e[t.attr_name]}}}())},s=function(e){var t;return t=e.option_values,t=_.sortBy(t,"option_type_presentation"),_.map(t,function(e){return{option_type:e.option_type_presentation,option_value:e.presentation}})},e}(),null==Spree.StockTransfers&&(Spree.StockTransfers={}),Spree.StockTransfers.VariantForm=e}).call(this);